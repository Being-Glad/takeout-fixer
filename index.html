<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PhotoTakeout Fixer</title>
    <!-- The "Module" Logo Favicon -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect width='100' height='100' rx='20' fill='%2318181b'/><rect x='25' y='25' width='20' height='20' rx='3' fill='%23a855f7'/><rect x='55' y='25' width='20' height='20' rx='3' fill='%236d28d9'/><rect x='25' y='55' width='50' height='20' rx='3' fill='%234f46e5'/></svg>">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        indigo: { 400: '#818cf8', 500: '#6366f1', 600: '#4f46e5', 700: '#4338ca' },
                        purple: { 400: '#c084fc', 500: '#a855f7', 600: '#9333ea' },
                        gray: { 800: '#1f2937', 900: '#111827', 950: '#09090b' }
                    }
                }
            }
        }
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; }
        .drop-zone { border: 2px dashed #4b5563; transition: all 0.2s; }
        .drop-zone.active { border-color: #818cf8; background-color: rgba(79, 70, 229, 0.1); }
        .accordion-content { max-height: 0; overflow: hidden; transition: max-height 0.3s ease-out; }
        .accordion-open .accordion-content { max-height: 500px; }
        .rotate-icon { transition: transform 0.3s ease; }
        .accordion-open .rotate-icon { transform: rotate(180deg); }
        .animate-fade-in { animation: fadeIn 0.2s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: scale(0.98); } to { opacity: 1; transform: scale(1); } }
        #download-modal { backdrop-filter: blur(5px); }
    </style>
</head>
<body class="bg-gray-950 text-gray-100 min-h-screen">

    <!-- Navigation -->
    <nav class="border-b border-gray-800 bg-gray-900/50 backdrop-blur-md sticky top-0 z-50">
        <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16 items-center">
                <a href="#" id="logo-link" class="flex items-center cursor-pointer">
                    <!-- The "Module" Logo (h-8 w-8 = 32px) -->
                    <svg class="h-8 w-8 mr-3" viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <rect width="100" height="100" rx="20" fill="#18181b"/>
                        <rect x="25" y="25" width="20" height="20" rx="3" fill="#a855f7"/>
                        <rect x="55" y="25" width="20" height="20" rx="3" fill="#6d28d9"/>
                        <rect x="25" y="55" width="50" height="20" rx="3" fill="#4f46e5"/>
                    </svg>
                    <span class="text-xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-indigo-400 to-purple-400">PhotoTakeout Fixer</span>
                </a>
                <div class="flex items-center space-x-4">
                    <a href="#features" class="text-sm font-medium text-gray-300 hover:text-white transition hidden sm:block">Features</a>
                    <a href="#faq" class="text-sm font-medium text-gray-300 hover:text-white transition hidden sm:block">FAQ</a>
                     <!-- Donate Button in Nav -->
                     <a href="https://buymeacoffee.com/Being_Glad" target="_blank" class="hidden sm:inline-flex items-center px-3 py-1.5 border border-yellow-500/50 text-sm font-medium rounded-md text-yellow-500 hover:bg-yellow-500/10 transition">
                        â˜• Buy me a coffee
                    </a>
                     <a href="#desktop-app" class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 transition">
                        Get Desktop App
                    </a>
                </div>
            </div>
        </div>
    </nav>

    <main>
        <!-- Hero Section -->
        <div class="relative overflow-hidden pt-16 pb-24 text-center">
             <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
                <!-- Hero Logo (h-24 w-24 = 96px) -->
                <svg class="h-24 w-24 mx-auto mb-8" viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <rect width="100" height="100" rx="20" fill="#18181b"/>
                    <rect x="25" y="25" width="20" height="20" rx="3" fill="#a855f7"/>
                    <rect x="55" y="25" width="20" height="20" rx="3" fill="#6d28d9"/>
                    <rect x="25" y="55" width="50" height="20" rx="3" fill="#4f46e5"/>
                </svg>
                <h1 class="text-4xl tracking-tight font-extrabold text-white sm:text-5xl md:text-6xl">
                    <span class="block">Get your memories</span>
                    <span class="block text-indigo-400">back in order.</span>
                </h1>
                <p class="mt-4 max-w-md mx-auto text-base text-gray-400 sm:text-lg md:mt-5 md:text-xl md:max-w-3xl">
                    Instantly restore the correct date and time for all your photos and videos exported from Google Takeout.
                </p>
                <div class="mt-10 max-w-sm mx-auto sm:max-w-none sm:flex sm:justify-center">
                     <a href="#quick-fix" class="w-full flex items-center justify-center px-8 py-3 border border-transparent text-base font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 md:py-4 md:text-lg md:px-10 transition">
                        Start Quick Fix
                    </a>
                    <a href="#desktop-app" class="mt-3 w-full flex items-center justify-center px-8 py-3 border border-transparent text-base font-medium rounded-md text-indigo-100 bg-indigo-900 bg-opacity-60 hover:bg-opacity-70 sm:mt-0 sm:ml-3 md:py-4 md:text-lg md:px-10 transition">
                        Download Pro App
                    </a>
                </div>
            </div>
        </div>

        <!-- Features Grid -->
        <div id="features" class="py-16 bg-gray-900">
            <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="text-center mb-12">
                    <h2 class="text-base font-semibold text-indigo-400 tracking-wide uppercase">Features</h2>
                    <p class="mt-2 text-3xl leading-8 font-extrabold tracking-tight text-white sm:text-4xl">What We Fix</p>
                </div>
                <div class="grid grid-cols-1 gap-8 sm:grid-cols-3">
                    <div class="pt-6">
                        <div class="flow-root bg-gray-800 rounded-xl px-6 pb-8 h-full border border-gray-700">
                            <div class="-mt-6">
                                <span class="inline-flex items-center justify-center p-3 bg-indigo-500 rounded-xl shadow-lg">
                                    <svg class="h-6 w-6 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
                                </span>
                                <h3 class="mt-8 text-lg font-medium text-white tracking-tight">Timestamps</h3>
                                <p class="mt-5 text-base text-gray-400">Restores the original "Date Taken" from JSON metadata, fixing your chronological timeline.</p>
                            </div>
                        </div>
                    </div>
                    <div class="pt-6">
                         <div class="flow-root bg-gray-800 rounded-xl px-6 pb-8 h-full border border-gray-700">
                            <div class="-mt-6">
                                <span class="inline-flex items-center justify-center p-3 bg-indigo-500 rounded-xl shadow-lg">
                                    <svg class="h-6 w-6 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" /><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" /></svg>
                                </span>
                                <h3 class="mt-8 text-lg font-medium text-white tracking-tight">GPS Locations</h3>
                                <p class="mt-5 text-base text-gray-400">(Desktop App) Writes original latitude and longitude back into files, restoring your photo map.</p>
                            </div>
                        </div>
                    </div>
                    <div class="pt-6">
                        <div class="flow-root bg-gray-800 rounded-xl px-6 pb-8 h-full border border-gray-700">
                             <div class="-mt-6">
                                <span class="inline-flex items-center justify-center p-3 bg-indigo-500 rounded-xl shadow-lg">
                                    <svg class="h-6 w-6 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" /></svg>
                                </span>
                                <h3 class="mt-8 text-lg font-medium text-white tracking-tight">Descriptions</h3>
                                <p class="mt-5 text-base text-gray-400">(Desktop App) Recovers your original captions and descriptions and embeds them back into the file.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Web App Section -->
        <div id="quick-fix" class="py-24">
            <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="bg-gray-900 rounded-2xl shadow-2xl overflow-hidden border border-gray-800">
                    <!-- Header -->
                    <div class="bg-gray-800 px-6 py-4 border-b border-gray-700 flex items-center justify-between">
                        <h2 class="text-lg font-semibold text-white flex items-center">
                             <svg class="h-5 w-5 mr-2" viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg"><rect width="100" height="100" rx="20" fill="#18181b"/><rect x="25" y="25" width="20" height="20" rx="3" fill="#a855f7"/><rect x="55" y="25" width="20" height="20" rx="3" fill="#6d28d9"/><rect x="25" y="55" width="50" height="20" rx="3" fill="#4f46e5"/></svg>
                            Quick-Fix Â· On the Go
                        </h2>
                        <!-- Start Over Button (Initially hidden) -->
                        <button id="header-reset-btn" class="hidden text-sm text-gray-400 hover:text-white transition flex items-center">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                              <path stroke-linecap="round" stroke-linejoin="round" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                            </svg>
                            Start Over
                        </button>
                    </div>

                    <div class="p-6 sm:p-8 space-y-6">
                        <div class="bg-indigo-900/30 border-l-4 border-indigo-500 p-4 rounded-r-lg flex">
                            <svg class="h-5 w-5 text-indigo-400 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd" /></svg>
                            <div class="ml-3 text-sm text-indigo-200">This lite version is for <span class="font-semibold text-white">quick jobs under 5GB</span>. It only fixes the file's "Date Modified" for sorting. For permanent EXIF data, use the Desktop App.</div>
                        </div>

                        <div id="upload-section" class="drop-zone rounded-xl p-10 text-center cursor-pointer hover:bg-gray-800/50 transition group">
                            <input type="file" id="fileInput" class="hidden" webkitdirectory directory multiple />
                            <div class="space-y-4 pointer-events-none">
                                <svg class="mx-auto h-16 w-16 text-gray-500 group-hover:text-indigo-400 transition" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" /></svg>
                                <div class="text-gray-300 text-lg"><span class="font-semibold text-indigo-400">Click to select</span> or drag your Takeout folder here</div>
                                <p class="text-sm text-gray-500">Supports .zip contents (unzipped)</p>
                            </div>
                        </div>

                        <div id="results-section" class="hidden space-y-6">
                            <div class="bg-green-900/20 border border-green-900 rounded-lg p-4 flex items-start">
                                 <svg class="h-6 w-6 text-green-500 mr-3 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
                                <div><h3 class="text-lg font-medium text-green-400">Processing Complete!</h3><p class="text-green-300/80 mt-1" id="results-summary"></p></div>
                            </div>
                             <!-- Donation Prompt (Shown after processing) -->
                             <div class="bg-gradient-to-r from-yellow-600/20 to-orange-600/20 border border-yellow-500/30 rounded-xl p-6 flex flex-col sm:flex-row items-center justify-between gap-6">
                                <div class="flex items-center"><span class="text-3xl mr-4">â˜•</span><div><h4 class="text-white font-semibold">Saved you time?</h4><p class="text-yellow-200/80 text-sm">Consider supporting future development to keep this tool free forever.</p></div></div>
                                <a href="https://buymeacoffee.com/Being_Glad" target="_blank" class="whitespace-nowrap bg-yellow-500 hover:bg-yellow-400 text-gray-900 font-bold py-3 px-6 rounded-xl transition shadow-lg shadow-yellow-500/20">Fuel Future Development</a>
                            </div>
                            <div id="download-buttons" class="space-y-4"></div>
                        </div>

                        <div id="log-accordion" class="border border-gray-800 rounded-lg overflow-hidden hidden">
                            <button id="log-toggle" class="w-full px-4 py-3 bg-gray-800/50 flex justify-between items-center text-left text-sm font-medium text-gray-300 hover:bg-gray-800 transition">
                                <span>Show Processing Log</span>
                                <svg class="rotate-icon h-5 w-5 text-gray-500" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" /></svg>
                            </button>
                             <div id="log-content" class="accordion-content bg-black"><div id="processing-log" class="p-4 font-mono text-xs text-gray-400 h-64 overflow-y-auto"></div></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Testimonials -->
        <section class="py-16 bg-gray-900 border-t border-gray-800">
             <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
                <h2 class="text-3xl font-extrabold text-white mb-8">Trusted by Users</h2>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-8 mb-10">
                    <div class="bg-gray-800 p-6 rounded-xl shadow-sm border border-gray-700"><p class="text-gray-300 italic">"I had 50GB of photos completely messed up. This tool fixed them all in minutes. Incredible work."</p><div class="mt-4 font-medium text-white">â€” Sarah K.</div></div>
                    <div class="bg-gray-800 p-6 rounded-xl shadow-sm border border-gray-700"><p class="text-gray-300 italic">"Better than the paid alternatives. The desktop app wrote the actual EXIF data back. Lifesaver!"</p><div class="mt-4 font-medium text-white">â€” Mike D.</div></div>
                    <div class="bg-gray-800 p-6 rounded-xl shadow-sm border border-gray-700"><p class="text-gray-300 italic">"Simple, fast, and free. It just works. Highly recommended for anyone leaving Google Photos."</p><div class="mt-4 font-medium text-white">â€” Alex R.</div></div>
                </div>
                <a href="https://github.com/Being-Glad/takeout-fixer/issues/new" target="_blank" class="text-indigo-400 hover:text-indigo-300 font-medium flex items-center justify-center">Share your feedback on GitHub <span aria-hidden="true" class="ml-1">â†’</span></a>
            </div>
        </section>

        <!-- Downloads Section -->
        <div id="desktop-app" class="py-24">
            <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
                 <h2 class="text-4xl font-extrabold text-white mb-4">Get the Full-Power Desktop App</h2>
                <p class="text-xl text-gray-400 mb-12 max-w-2xl mx-auto">No size limits. Permanent EXIF, GPS & Description fixes. Runs entirely offline.</p>
                <div class="flex flex-col sm:flex-row justify-center items-center gap-6" id="download-links">
                     <!-- Download buttons will be dynamically inserted here -->
                </div>
                <p class="mt-8 text-gray-500">100% Free & Open Source</p>
            </div>
        </div>

        <!-- FAQ -->
        <section id="faq" class="py-16 bg-gray-900 border-t border-gray-800">
             <div class="max-w-3xl mx-auto px-4 sm:px-6 lg:px-8">
                <h2 class="text-3xl font-extrabold text-white text-center mb-12">Frequently Asked Questions</h2>
                <div class="space-y-4">
                    <div class="bg-gray-800 rounded-lg overflow-hidden border border-gray-700">
                        <button class="faq-toggle w-full px-6 py-4 text-left flex justify-between items-center focus:outline-none"><span class="text-lg font-medium text-white">Why do I need this?</span><svg class="h-5 w-5 text-gray-400 transform transition-transform" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" /></svg></button>
                        <div class="faq-content hidden px-6 pb-4 text-gray-400">Google Takeout separates metadata (date, location, description) into JSON files. This tool reads them and puts the correct info back, so your photos don't all show today's date in your gallery.</div>
                    </div>
                    <div class="bg-gray-800 rounded-lg overflow-hidden border border-gray-700">
                        <button class="faq-toggle w-full px-6 py-4 text-left flex justify-between items-center focus:outline-none"><span class="text-lg font-medium text-white">Is it safe?</span><svg class="h-5 w-5 text-gray-400 transform transition-transform" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" /></svg></button>
                        <div class="faq-content hidden px-6 pb-4 text-gray-400">Yes. It is 100% safe. All processing happens <span class="font-semibold text-white">entirely on your device</span>. Your photos never leave your computer. The code is open-source for transparency.</div>
                    </div>
                    <div class="bg-gray-800 rounded-lg overflow-hidden border border-gray-700">
                        <button class="faq-toggle w-full px-6 py-4 text-left flex justify-between items-center focus:outline-none"><span class="text-lg font-medium text-white">Web App vs Desktop App?</span><svg class="h-5 w-5 text-gray-400 transform transition-transform" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" /></svg></button>
                        <div class="faq-content hidden px-6 pb-4 text-gray-400">The <span class="font-semibold text-white">Quick-Fix (Web)</span> app is for small batches (<5GB) and only fixes sorting dates. The <span class="font-semibold text-white">Desktop App</span> has unlimited size and permanently writes true EXIF/GPS/Description data into the files themselves.</div>
                    </div>
                    <div class="bg-gray-800 rounded-lg overflow-hidden border border-gray-700">
                        <button class="faq-toggle w-full px-6 py-4 text-left flex justify-between items-center focus:outline-none"><span class="text-lg font-medium text-white">Will this create duplicates?</span><svg class="h-5 w-5 text-gray-400 transform transition-transform" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" /></svg></button>
                        <div class="faq-content hidden px-6 pb-4 text-gray-400">The Desktop App's "Fix In-Place" mode modifies files <span class="font-semibold text-white">in-place</span>, so NO duplicates are created. The Web App and other desktop modes create new fixed files, leaving your originals untouched.</div>
                    </div>
                     <div class="bg-gray-800 rounded-lg overflow-hidden border border-gray-700">
                        <button class="faq-toggle w-full px-6 py-4 text-left flex justify-between items-center focus:outline-none"><span class="text-lg font-medium text-white">Works with Apple Photos?</span><svg class="h-5 w-5 text-gray-400 transform transition-transform" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" /></svg></button>
                        <div class="faq-content hidden px-6 pb-4 text-gray-400">Yes! Use the <span class="font-semibold text-white">Desktop App</span> to process your files first. Then, when you import them into Apple Photos, they will appear in the correct chronological order with all location data and descriptions intact.</div>
                    </div>
                    <div class="bg-gray-800 rounded-lg overflow-hidden border border-gray-700">
                        <button class="faq-toggle w-full px-6 py-4 text-left flex justify-between items-center focus:outline-none"><span class="text-lg font-medium text-white">How fast is it?</span><svg class="h-5 w-5 text-gray-400 transform transition-transform" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" /></svg></button>
                        <div class="faq-content hidden px-6 pb-4 text-gray-400">Extremely fast. It can process thousands of photos per minute because it runs locally on your computer's full power, not on a slow server.</div>
                    </div>
                </div>
            </div>
        </section>

        <footer class="bg-black py-8 text-center text-gray-500 text-sm">
            <p>Created with ðŸ’œ by <a href="https://github.com/Being-Glad" class="hover:text-indigo-400 transition">Being_Glad</a>. Not affiliated with Google.</p>
        </footer>

        <!-- Interstitial Donation Modal -->
        <div id="download-modal" class="fixed inset-0 z-50 hidden flex items-center justify-center bg-black/80 backdrop-blur-sm animate-fade-in">
            <div class="bg-gray-800 rounded-2xl shadow-2xl p-8 max-w-md mx-4 border border-gray-700 relative">
                 <!-- Close Button -->
                 <button id="modal-close" class="absolute top-4 right-4 text-gray-400 hover:text-white transition">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                      <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
                <div class="text-center">
                    <div class="mx-auto flex items-center justify-center h-16 w-16 rounded-full bg-yellow-900/30 mb-6">
                        <span class="text-4xl">ðŸŽ‰</span>
                    </div>
                    <h3 class="text-2xl font-bold text-white mb-2">Ready to Download!</h3>
                    <p class="text-gray-400 mb-8">
                        If this tool saved you time, please consider supporting its development to keep it free forever.
                    </p>
                    <div class="space-y-3">
                        <button id="donate-download-btn" class="w-full flex items-center justify-center px-4 py-3 bg-yellow-500 hover:bg-yellow-400 text-gray-900 font-bold rounded-xl transition">
                            <span class="mr-2">â˜•</span> Donate & Download
                        </button>
                        <button id="just-download-btn" class="w-full px-4 py-3 bg-gray-700 hover:bg-gray-600 text-gray-300 font-semibold rounded-xl transition">
                            No thanks, just download
                        </button>
                    </div>
                </div>
            </div>
        </div>

    </main>

    <script>
        // --- DOM Elements ---
        const logoLink = document.getElementById('logo-link');
        const headerResetBtn = document.getElementById('header-reset-btn');
        const uploadSection = document.getElementById('upload-section');
        const resultsSection = document.getElementById('results-section');
        const logAccordion = document.getElementById('log-accordion');
        const logToggle = document.getElementById('log-toggle');
        const fileInput = document.getElementById('fileInput');
        const logContainer = document.getElementById('processing-log');
        const downloadButtons = document.getElementById('download-buttons');
        const resultsSummary = document.getElementById('results-summary');
        const downloadModal = document.getElementById('download-modal');
        const donateDownloadBtn = document.getElementById('donate-download-btn');
        const justDownloadBtn = document.getElementById('just-download-btn');
        const modalCloseBtn = document.getElementById('modal-close');
        
        const FIVE_GB = 5 * 1024 * 1024 * 1024;
        let fileMap = new Map();
        let mediaFileStore = new Map();
        let rootFolderName = 'Takeout';
        let pendingAction = null; // For modal

        // --- Core App Logic ---
        function resetApp() {
            uploadSection.classList.remove('hidden');
            resultsSection.classList.add('hidden');
            logAccordion.classList.add('hidden'); 
            logAccordion.classList.remove('accordion-open');
            logToggle.querySelector('span').textContent = 'Show Processing Log';
            headerResetBtn.classList.add('hidden');
            fileInput.value = '';
            fileMap.clear();
            mediaFileStore.clear();
        }

        async function handleFiles(event) {
            const files = event.target.files;
            if (files.length === 0) return;

            resetApp(); // Clear previous results
            uploadSection.classList.add('hidden');
            logAccordion.classList.remove('hidden');
            headerResetBtn.classList.remove('hidden'); // Show Start Over
            if (!logAccordion.classList.contains('accordion-open')) {
                logToggle.click(); 
            }
            
            logContainer.innerHTML = '';
            downloadButtons.innerHTML = '';
            log('Starting analysis of your Takeout folder...');

            let mediaFiles = [];
            let jsonFiles = [];
            let totalSize = 0;
            
            rootFolderName = files[0].webkitRelativePath.split('/')[0] || 'Takeout';

            const mediaExts = new Set(['jpg', 'jpeg', 'png', 'gif', 'webp', 'heic', 'tiff', 'mov', 'mp4', 'avi', 'mkv', '3gp']);

            for (const file of files) {
                totalSize += file.size;
                const ext = file.name.split('.').pop()?.toLowerCase();
                if (ext === 'json') {
                    jsonFiles.push(file);
                } else if (mediaExts.has(ext)) {
                    mediaFiles.push(file);
                    mediaFileStore.set(file.webkitRelativePath, file);
                }
            }

            if (totalSize > FIVE_GB) {
                log('ERROR: Total folder size is > 5GB. Please use the Desktop App.', 'error');
                alert("Your folder is over 5GB. Please use the Desktop App for unlimited size and permanent fixes.");
                resetApp(); // Auto-reset on error
                return;
            }

            log(`Found ${mediaFiles.length} media files and ${jsonFiles.length} JSON metadata files.`);

            for (const file of jsonFiles) {
                try {
                    const text = await file.text();
                    const data = JSON.parse(text);
                    const timestamp = data.photoTakenTime?.timestamp || data.creationTime?.timestamp;
                    if (timestamp) {
                        fileMap.set(normalizePath(file.webkitRelativePath), { timestamp: parseInt(timestamp) });
                    }
                } catch (e) { /* ignore bad json */ }
            }
            log(`Successfully parsed metadata from ${fileMap.size} JSON files.`);

            let fixedFiles = new Map();
            let skippedCount = 0;
            let fixedCount = 0;

            for (const mediaFile of mediaFiles) {
                const relativePath = mediaFile.webkitRelativePath;
                const key = normalizePath(relativePath);
                let timestamp = null;

                if (fileMap.has(key)) {
                    timestamp = fileMap.get(key).timestamp;
                } else {
                    const dateFromFilename = parseDateFromFilename(mediaFile.name);
                    if (dateFromFilename) {
                        timestamp = Math.floor(dateFromFilename.getTime() / 1000);
                    }
                }

                const pathParts = relativePath.split('/');
                let folderName = 'root';
                if (pathParts.length > 2) {
                    folderName = pathParts[1];
                }

                if (!fixedFiles.has(folderName)) {
                    fixedFiles.set(folderName, []);
                }

                if (timestamp) {
                    fixedFiles.get(folderName).push({ path: relativePath, newDate: timestamp * 1000, skipped: false });
                    fixedCount++;
                } else {
                    fixedFiles.get(folderName).push({ path: relativePath, skipped: true });
                    skippedCount++;
                    log(`Skipped (no date found): ${mediaFile.name}`, 'warn');
                }
            }

            log(`Processing complete! ${fixedCount} files matched. ${skippedCount} files skipped (will be included in '_SKIPPED' folders).`, 'success');
            resultsSummary.textContent = `Success! ${fixedCount} files matched. ${skippedCount} skipped files will be included in a separate folder.`;
            
            if (fixedCount > 0 || skippedCount > 0) {
                displayDownloadButtons(fixedFiles);
            } else {
                 log('No files could be processed.', 'error');
            }
        }

        function displayDownloadButtons(folderMap) {
            resultsSection.classList.remove('hidden');
            
            const masterBtn = createDownloadButton(`${rootFolderName}-Fixed.zip`, `Download All Folders (${mediaFileStore.size} files)`, true);
            masterBtn.onclick = () => showDownloadModal(() => downloadFolder(folderMap, `${rootFolderName}-Fixed.zip`, masterBtn));
            downloadButtons.appendChild(masterBtn);

            if (folderMap.size <= 1) return;

            const separator = document.createElement('div');
            separator.className = "flex items-center py-4";
            separator.innerHTML = '<div class="flex-grow h-px bg-gray-700"></div><span class="flex-shrink-0 text-gray-500 px-4 text-sm font-medium">OR DOWNLOAD INDIVIDUALLY</span><div class="flex-grow h-px bg-gray-700"></div>';
            downloadButtons.appendChild(separator);

            const sortedFolders = Array.from(folderMap.keys()).sort().reverse();
            for (const folderName of sortedFolders) {
                if (folderName === 'root' && folderMap.size > 1 && folderMap.get('root').length === 0) continue;
                const files = folderMap.get(folderName);
                const btn = createDownloadButton(`${folderName}.zip`, `Download ${folderName} (${files.length} files)`, false);
                const singleFolderMap = new Map([[folderName, files]]);
                btn.onclick = () => showDownloadModal(() => downloadFolder(singleFolderMap, `${folderName}.zip`, btn));
                downloadButtons.appendChild(btn);
            }
        }

        function createDownloadButton(fileName, text, isMaster) {
            const btn = document.createElement('button');
            btn.className = `w-full flex items-center justify-center px-6 py-4 ${isMaster ? 'bg-green-600 hover:bg-green-500 text-white font-bold text-lg' : 'bg-green-600/80 hover:bg-green-500/80 text-white font-semibold'} rounded-xl transition shadow-lg`;
            btn.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" /></svg> ${text}`;
            return btn;
        }

        async function downloadFolder(folderMap, zipName, btn) {
            const originalText = btn.innerHTML;
            btn.innerHTML = '<svg class="animate-spin h-5 w-5 mr-3 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg> Zipping...';
            btn.disabled = true;
            log(`Zipping ${zipName}...`);

            const zip = new JSZip();
            for (const [folderName, files] of folderMap.entries()) {
                for (const fileData of files) {
                    const originalFile = mediaFileStore.get(fileData.path);
                    if (originalFile) {
                        let zipPath = originalFile.webkitRelativePath.substring(originalFile.webkitRelativePath.indexOf('/') + 1);
                        if (fileData.skipped) {
                             const pathParts = zipPath.split('/');
                             const fileName = pathParts.pop();
                             zipPath = [...pathParts, '_SKIPPED', fileName].join('/');
                        }
                        if (zipPath) {
                            const dateToUse = fileData.skipped ? new Date(originalFile.lastModified) : new Date(fileData.newDate);
                            zip.file(zipPath, originalFile, { date: dateToUse, binary: true });
                        }
                    }
                }
            }

            try {
                const content = await zip.generateAsync({ type: "blob" });
                log(`Successfully created ${zipName}!`, 'success');
                const link = document.createElement('a');
                link.href = URL.createObjectURL(content);
                link.download = zipName;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                URL.revokeObjectURL(link.href);
            } catch (e) {
                log(`Error zipping: ${e.message}`, 'error');
            } finally {
                btn.innerHTML = originalText;
                btn.disabled = false;
            }
        }

        // --- Utils & Event Handlers ---
        function log(message, type = 'info') {
            const p = document.createElement('p');
            let color = 'text-gray-400';
            if (type === 'error') color = 'text-red-400';
            if (type === 'success') color = 'text-green-400';
            if (type === 'warn') color = 'text-yellow-400';
            p.className = `${color} mb-1 break-all`;
            p.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            logContainer.prepend(p);
        }

        const normalizePath = (p) => p.toLowerCase().replace(/\.json$/i, '').replace(/(\(\d+\))|(_\d{13,})|(-collage)|(-cinematic)|(-remastered)|(-pop_out)|(-edited)/g, '').trim();

        const parseDateFromFilename = (filename) => {
            const regexes = [/(\d{4})[-_]?(\d{2})[-_]?(\d{2})[-_]?(\d{2})[-_]?(\d{2})[-_]?(\d{2})/, /IMG[-_](\d{4})(\d{2})(\d{2})[-_](\d{6})/, /(\d{4})[-_](\d{2})[-_](\d{2})/];
            for (const regex of regexes) {
                const match = filename.match(regex);
                if (match) {
                    const y = parseInt(match[1]);
                    if (y >= 1970 && y <= new Date().getFullYear() + 1) {
                        return new Date(Date.UTC(y, parseInt(match[2]) - 1, parseInt(match[3]), match[4] ? parseInt(match[4]) : 12, match[5] ? parseInt(match[5]) : 0, match[6] ? parseInt(match[6]) : 0));
                    }
                }
            }
            return null;
        }

        // --- Modal Logic ---
        function showDownloadModal(action) {
            pendingAction = action;
            downloadModal.classList.remove('hidden');
        }
        function hideDownloadModal() {
            downloadModal.classList.add('hidden');
            pendingAction = null;
        }
        modalCloseBtn.addEventListener('click', hideDownloadModal);
        donateDownloadBtn.addEventListener('click', () => {
            window.open('https://buymeacoffee.com/Being_Glad', '_blank');
            if (pendingAction) pendingAction();
            hideDownloadModal();
        });
        justDownloadBtn.addEventListener('click', () => {
            if (pendingAction) pendingAction();
            hideDownloadModal();
        });

        // --- Initial Setup ---
        // Logo refresh
        logoLink.addEventListener('click', (e) => {
            e.preventDefault();
            resetApp();
            window.scrollTo({ top: 0, behavior: 'smooth' });
        });
        headerResetBtn.addEventListener('click', resetApp);
        
        // FAQ Toggles
        document.querySelectorAll('.faq-toggle').forEach(button => {
            button.addEventListener('click', () => {
                const content = button.nextElementSibling;
                content.classList.toggle('hidden');
                button.querySelector('svg').classList.toggle('rotate-180');
            });
        });

        // Log Toggle
        logToggle.addEventListener('click', () => {
            logAccordion.classList.toggle('accordion-open');
            logToggle.querySelector('span').textContent = logAccordion.classList.contains('accordion-open') ? 'Hide Processing Log' : 'Show Processing Log';
        });

        // Drag/Drop Handlers
        ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => uploadSection.addEventListener(eventName, e => { e.preventDefault(); e.stopPropagation(); }, false));
        ['dragenter', 'dragover'].forEach(eventName => uploadSection.addEventListener(eventName, () => uploadSection.classList.add('active'), false));
        ['dragleave', 'drop'].forEach(eventName => uploadSection.addEventListener(eventName, () => uploadSection.classList.remove('active'), false));
        uploadSection.addEventListener('drop', e => handleFiles({ target: { files: e.dataTransfer.files } }), false);
        uploadSection.addEventListener('click', () => fileInput.click());
        fileInput.addEventListener('change', handleFiles);
        
        // --- Dynamic Download Button Setup ---
        // Fetch latest release from GitHub to populate download links
        const repo = "Being-Glad/takeout-fixer";
        const downloadLinksContainer = document.getElementById('download-links');

        fetch(`https://api.github.com/repos/${repo}/releases/latest`)
            .then(response => response.json())
            .then(data => {
                const assets = data.assets;
                if (!assets || assets.length === 0) throw new Error('No assets found');
                
                const platforms = [
                    { os: 'Windows', ext: '.exe', arch: 'x64' },
                    { os: 'Mac (Apple)', ext: '.dmg', arch: 'arm64' },
                    { os: 'Mac (Intel)', ext: '.dmg', arch: 'x64' },
                    { os: 'Linux', ext: '.AppImage', arch: 'x64' }
                ];

                downloadLinksContainer.innerHTML = ''; // Clear any placeholders

                platforms.forEach(p => {
                    const asset = assets.find(a => a.name.endsWith(p.ext) && a.name.includes(p.arch));
                    const url = asset ? asset.browser_download_url : `https://github.com/${repo}/releases/latest`;
                    
                    const btn = document.createElement('button');
                    btn.className = "desktop-download-btn group flex flex-col items-center justify-center p-6 bg-gray-800 border-2 border-gray-700 rounded-2xl hover:border-indigo-500 transition w-64 h-32 cursor-pointer";
                    btn.innerHTML = `
                        <span class="text-gray-400 font-medium text-sm mb-2">Download for</span>
                        <span class="text-white text-2xl font-bold group-hover:text-indigo-300 transition">${p.os}</span>
                        ${!asset ? '<span class="text-xs text-red-400 mt-1">Build pending</span>' : ''}
                    `;
                    btn.addEventListener('click', () => showDownloadModal(() => window.location.href = url));
                    downloadLinksContainer.appendChild(btn);
                });
            })
            .catch(err => {
                console.error("Failed to fetch GitHub release info:", err);
                // Fallback buttons if API fails
                downloadLinksContainer.innerHTML = `
                    <a href="https://github.com/${repo}/releases/latest" target="_blank" class="w-full sm:w-auto flex items-center justify-center px-8 py-3 border border-transparent text-base font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 md:py-4 md:text-lg md:px-10 transition">
                        View All Releases on GitHub
                    </a>
                `;
            });

    </script>
</body>
</html>