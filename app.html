<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Takeout Date Fixer</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect width='100' height='100' rx='20' fill='%2318181b'/><rect x='25' y='25' width='20' height='20' rx='3' fill='%23a855f7'/><rect x='55' y='25' width='20' height='20' rx='3' fill='%236d28d9'/><rect x='25' y='55' width='50' height='20' rx='3' fill='%234f46e5'/></svg>">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        indigo: { 400: '#818cf8', 500: '#6366f1', 600: '#4f46e5', 700: '#4338ca' },
                        gray: { 800: '#1f2937', 900: '#111827', 950: '#09090b' },
                        yellow: { 400: '#facc15', 500: '#eab308' }
                    }
                }
            }
        }
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; user-select: none; }
        /* Draggable Header */
        #app-header { -webkit-app-region: drag; }
        #app-header button, #app-header a { -webkit-app-region: no-drag; }
        /* Fix for Mac Traffic Lights */
        .platform-darwin #app-header { padding-left: 72px; }
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #1f2937; }
        ::-webkit-scrollbar-thumb { background: #4b5563; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #6b7280; }
        /* Accordion */
        .accordion-content { max-height: 0; overflow: hidden; transition: max-height 0.3s ease-out; }
        .accordion-open .accordion-content { max-height: 500px; }
        .rotate-icon { transition: transform 0.3s ease; }
        .accordion-open .rotate-icon { transform: rotate(180deg); }
        .animate-fade-in { animation: fadeIn 0.3s ease-out; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    </style>
</head>
<body class="bg-gray-950 text-gray-100 min-h-screen overflow-hidden flex flex-col">

    <header id="app-header" class="flex justify-between items-center bg-gray-900/50 backdrop-blur-md border-b border-gray-800 p-3 fixed top-0 left-0 right-0 z-50">
        <div class="flex items-center">
            <svg class="h-6 w-6 mr-3" width="64" height="64" viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg">
                <rect width="100" height="100" rx="20" fill="#111827"/>
                <rect x="25" y="25" width="20" height="20" rx="3" fill="#a855f7"/>
                <rect x="55" y="25" width="20" height="20" rx="3" fill="#6d28d9"/>
                <rect x="25" y="55" width="50" height="20" rx="3" fill="#4f46e5"/>
            </svg>
            <span class="text-base font-bold bg-clip-text text-transparent bg-gradient-to-r from-indigo-400 to-purple-400">Takeout Date Fixer</span>
        </div>
        <div class="flex items-center space-x-4">
            <button id="header-reset-btn" class="hidden text-sm text-gray-400 hover:text-white transition flex items-center">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                </svg>
                Start Over
            </button>
            <a id="header-donate-btn" href="https://buymeacoffee.com/Being_Glad" target="_blank" class="inline-flex items-center px-3 py-1.5 border border-yellow-500/50 text-sm font-medium rounded-md text-yellow-500 hover:bg-yellow-500/10 transition">
                ☕ Buy me a coffee
            </a>
        </div>
    </header>

    <main class="flex-grow pt-16 overflow-y-auto">
        <div class="max-w-4xl mx-auto p-4 sm:p-6 lg:p-8 space-y-8">
            
            <section id="upload-section" class="bg-gray-900 rounded-2xl shadow-2xl overflow-hidden border border-gray-800">
                <div class="p-6 sm:p-8">
                    <div class="space-y-6">
                        <div class="bg-indigo-900/30 border-l-4 border-indigo-500 p-4 rounded-r-lg flex">
                            <svg class="h-5 w-5 text-indigo-400 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd" /></svg>
                            <div class="ml-3 text-sm text-indigo-200">This app modifies files <span class="font-semibold text-white">in-place</span>. No copies are made.</div>
                        </div>

                        <div id="drop-zone" class="drop-zone rounded-xl p-10 text-center cursor-pointer border-2 border-dashed border-gray-700 hover:border-indigo-500 hover:bg-gray-800/50 transition group">
                            <div class="space-y-4 pointer-events-none">
                                <svg class="mx-auto h-16 w-16 text-gray-500 group-hover:text-indigo-400 transition" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z" /></svg>
                                <div class="text-gray-300 text-lg"><span class="font-semibold text-indigo-400">Click to select folders or files</span></div>
                                <p class="text-sm text-gray-500">You can also drag and drop your Takeout folders here.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <section id="results-section" class="hidden animate-fade-in space-y-6">
                <div class="bg-green-900/20 border border-green-900 rounded-lg p-4 flex items-start">
                     <svg class="h-6 w-6 text-green-500 mr-3 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
                    <div>
                        <h3 class="text-lg font-medium text-green-400">Processing Complete!</h3>
                        <p class="text-green-300/80 mt-1" id="results-summary"></p>
                    </div>
                </div>
                <div class="bg-gradient-to-r from-yellow-500/20 to-yellow-600/20 border border-yellow-500/30 rounded-xl p-6 flex flex-col sm:flex-row items-center justify-between gap-6">
                    <div class="flex items-center"><span class="text-3xl mr-4">☕</span><div><h4 class="text-white font-semibold">Saved you time?</h4><p class="text-yellow-200/80 text-sm">Consider supporting future development to keep this tool free forever.</p></div></div>
                    <a id="donate-btn-results" href="https://buymeacoffee.com/Being_Glad" target="_blank" class="whitespace-nowrap bg-yellow-500 hover:bg-yellow-400 text-gray-900 font-bold py-3 px-6 rounded-xl transition shadow-lg shadow-yellow-500/20">Fuel Future Development</a>
                </div>
            </section>

            <div id="log-accordion" class="border border-gray-800 rounded-lg overflow-hidden">
                <button id="log-toggle" class="w-full px-4 py-3 bg-gray-800/50 flex justify-between items-center text-left text-sm font-medium text-gray-300 hover:bg-gray-800 transition">
                    <span>Show Processing Log</span>
                    <svg class="rotate-icon h-5 w-5 text-gray-500" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" /></svg>
                </button>
                 <div id="log-content" class="accordion-content bg-black">
                     <div id="progress-bar-container" class="p-4 space-y-2 hidden border-b border-gray-700">
                         <div class="w-full bg-gray-700 rounded-full h-2.5">
                            <div id="progress-bar-inner" class="bg-indigo-600 h-2.5 rounded-full" style="width: 0%; transition: width 0.2s ease;"></div>
                        </div>
                        <span id="progress-text" class="text-sm text-gray-400 font-mono">Processing...</span>
                    </div>
                     <div id="processing-log" class="p-4 font-mono text-xs text-gray-400 h-64 overflow-y-auto">
                        <p class="text-gray-500">Waiting to start...</p>
                    </div>
                </div>
            </div>

            <section class="pt-6">
                <h3 class="text-base font-semibold text-indigo-400 tracking-wide uppercase text-center mb-6">Pro Features Active</h3>
                <div class="grid grid-cols-1 gap-8 sm:grid-cols-3">
                    <div class="flex items-center space-x-4">
                        <span class="inline-flex items-center justify-center p-3 bg-indigo-500 rounded-xl shadow-lg">
                            <svg class="h-6 w-6 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
                        </span>
                        <div>
                            <h4 class="text-lg font-medium text-white">EXIF Timestamps</h4>
                            <p class="text-sm text-gray-400">Writes permanent "Date Taken".</p>
                        </div>
                    </div>
                    <div class="flex items-center space-x-4">
                         <span class="inline-flex items-center justify-center p-3 bg-indigo-500 rounded-xl shadow-lg">
                            <svg class="h-6 w-6 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" /><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" /></svg>
                        </span>
                        <div>
                            <h4 class="text-lg font-medium text-white">GPS Locations</h4>
                            <p class="text-sm text-gray-400">Restores original map data.</p>
                        </div>
                    </div>
                    <div class="flex items-center space-x-4">
                        <span class="inline-flex items-center justify-center p-3 bg-indigo-500 rounded-xl shadow-lg">
                            <svg class="h-6 w-6 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H7a3 3 0 00-3 3v8a3 3 0 003 3z" /></svg>
                        </span>
                        <div>
                            <h4 class="text-lg font-medium text-white">Unlimited Files</h4>
                            <p class="text-sm text-gray-400">No browser size limits.</p>
                        </div>
                    </div>
                </div>
            </section>

        </div>
    </main>
    
    <script>
        // --- UI Elements ---
        const dropZone = document.getElementById('drop-zone');
        const logContainer = document.getElementById('processing-log');
        const logToggle = document.getElementById('log-toggle');
        const logAccordion = document.getElementById('log-accordion');
        const resultsSection = document.getElementById('results-section');
        const uploadSection = document.getElementById('upload-section');
        const resultsSummary = document.getElementById('results-summary');
        const progressContainer = document.getElementById('progress-bar-container');
        const progressText = document.getElementById('progress-text');
        const progressBar = document.getElementById('progress-bar-inner');
        const headerResetBtn = document.getElementById('header-reset-btn');
        const appHeader = document.getElementById('app-header');
        const donateBtnResults = document.getElementById('donate-btn-results');

        // --- Mac Platform Fix ---
        window.electron.getPlatform().then(platform => {
            if (platform === 'darwin') {
                appHeader.classList.add('platform-darwin');
            }
        });
        
        // --- App State ---
        function resetApp() {
            uploadSection.classList.remove('hidden');
            resultsSection.classList.add('hidden');
            progressContainer.classList.add('hidden');
            headerResetBtn.classList.add('hidden');
            logContainer.innerHTML = '<p class="text-gray-500">Waiting to start...</p>';
            if (logAccordion.classList.contains('accordion-open')) {
                logToggle.click();
            }
        }
        resetApp(); // Initial state

        // --- Event Listeners (UI -> Electron) ---
        dropZone.addEventListener('click', async () => {
            const paths = await window.electron.openDirectory();
            if (paths && paths.length > 0) {
                startProcessing(paths);
            }
        });
        
        // Drag and Drop
        dropZone.addEventListener('dragover', (e) => {
            e.preventDefault(); e.stopPropagation();
            dropZone.classList.add('border-indigo-500', 'bg-gray-800/50');
        });
        dropZone.addEventListener('dragleave', (e) => {
            e.preventDefault(); e.stopPropagation();
            dropZone.classList.remove('border-indigo-500', 'bg-gray-800/50');
        });
        dropZone.addEventListener('drop', (e) => {
            e.preventDefault(); e.stopPropagation();
            dropZone.classList.remove('border-indigo-500', 'bg-gray-800/50');
            const paths = [...e.dataTransfer.files].map(f => f.path);
            if (paths && paths.length > 0) {
                startProcessing(paths);
            }
        });
        
        headerResetBtn.addEventListener('click', () => {
             // Simple reload is the most robust way to reset the Electron backend state
             window.location.reload();
        });
        
        // External link handler for the results donation button
        donateBtnResults.addEventListener('click', (e) => {
            e.preventDefault();
            window.electron.openExternal(e.currentTarget.href);
        });

        function startProcessing(paths) {
            // Reset UI to processing state
            uploadSection.classList.add('hidden');
            resultsSection.classList.add('hidden');
            progressContainer.classList.remove('hidden');
            headerResetBtn.classList.remove('hidden');
            logContainer.innerHTML = '';
            if (!logAccordion.classList.contains('accordion-open')) {
                logToggle.click();
            }
            // Send paths to backend
            window.electron.startProcessing(paths);
        }

        // --- Event Handlers (Electron -> UI) ---
        window.electron.onLog((msg, type = 'info') => {
            const p = document.createElement('p');
            let color = 'text-gray-400';
            if (type === 'error') color = 'text-red-400';
            if (type === 'warn') color = 'text-yellow-400';
            if (type === 'success') color = 'text-green-400';
            p.className = `${color} mb-1`;
            p.textContent = `[${new Date().toLocaleTimeString()}] ${msg}`;
            logContainer.prepend(p);
        });
        
        window.electron.onProgress((current, total) => {
            const percent = total > 0 ? (current / total) * 100 : 0;
            progressBar.style.width = `${percent}%`;
            progressText.textContent = `Processing file ${current} of ${total}`;
        });

        window.electron.onComplete((stats) => {
            resultsSummary.textContent = `Successfully fixed ${stats.fixed} files. ${stats.skipped} files were skipped.`;
            resultsSection.classList.remove('hidden'); // Show success banners
            progressContainer.classList.add('hidden'); // Hide progress bar
        });
        
        // Log Accordion Toggle
        logToggle.addEventListener('click', () => {
            logAccordion.classList.toggle('accordion-open');
            logToggle.querySelector('span').textContent = logAccordion.classList.contains('accordion-open') ? 'Hide Processing Log' : 'Show Processing Log';
        });
    </script>
</body>
</html> 